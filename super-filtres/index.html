<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√âditeur d'Images Multi-Filtres</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
            font-size: 2em;
        }

        .main-area {
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 20px;
            align-items: start;
        }

        /* Zone centrale - Viewer multi-images */
        .canvas-section {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .viewer-container {
            width: 100%;
            min-height: 500px;
            background: #f8f9fa;
            border-radius: 15px;
            padding: 15px;
            position: relative;
        }

        .images-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 12px;
            width: 100%;
        }

        .image-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }

        .image-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }

        .image-card canvas {
            width: 100%;
            height: auto;
            display: block;
        }

        .image-card-footer {
            padding: 8px;
            background: #f8f9fa;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .image-number {
            background: #667eea;
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
        }

        .remove-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            font-size: 16px;
            line-height: 1;
            transition: all 0.3s;
        }

        .remove-btn:hover {
            background: #c0392b;
            transform: scale(1.1);
        }

        .upload-overlay {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 15px;
            color: #999;
        }

        .upload-overlay svg {
            width: 60px;
            height: 60px;
            opacity: 0.3;
        }

        .upload-btn {
            background: #667eea;
            color: white;
            padding: 12px 35px;
            border: none;
            border-radius: 50px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .upload-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        #fileInput {
            display: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .control-btn {
            padding: 10px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .add-btn {
            background: #667eea;
            color: white;
        }

        .add-btn:hover {
            background: #764ba2;
            transform: translateY(-2px);
        }

        .download-all-btn {
            background: #3498db;
            color: white;
        }

        .download-all-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .clear-filter-btn {
            background: #e67e22;
            color: white;
        }

        .clear-filter-btn:hover {
            background: #d35400;
            transform: translateY(-2px);
        }

        .control-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Panel de filtres √† droite */
        .filters-panel {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 15px;
            max-height: 850px;
            overflow-y: auto;
        }

        .filters-panel h2 {
            font-size: 1.1em;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .filter-category {
            margin-bottom: 20px;
        }

        .filter-category h3 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 0.85em;
            border-bottom: 2px solid #667eea;
            padding-bottom: 5px;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .filter-item {
            cursor: pointer;
            border: 2px solid transparent;
            border-radius: 8px;
            overflow: hidden;
            transition: all 0.3s;
            background: white;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .filter-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .filter-item.active {
            border-color: #764ba2;
            box-shadow: 0 4px 12px rgba(118, 75, 162, 0.5);
        }

        .filter-preview {
            width: 100%;
            aspect-ratio: 1;
            overflow: hidden;
            background: #ddd;
            position: relative;
        }

        .filter-preview canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .filter-preview .no-image {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #e0e0e0 0%, #f5f5f5 100%);
            font-size: 30px;
        }

        .filter-name {
            padding: 6px;
            text-align: center;
            font-size: 10px;
            font-weight: 600;
            color: #333;
            background: white;
        }

        /* Scrollbar personnalis√©e */
        .filters-panel::-webkit-scrollbar {
            width: 6px;
        }

        .filters-panel::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .filters-panel::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 10px;
        }

        .info-badge {
            background: #3498db;
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75em;
            text-align: center;
            margin-bottom: 12px;
        }

        .current-filter-badge {
            background: #27ae60;
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            text-align: center;
            margin-bottom: 12px;
            font-weight: 600;
        }

        @media (max-width: 1200px) {
            .main-area {
                grid-template-columns: 1fr;
            }
            
            .filter-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 768px) {
            .filter-grid {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .images-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® √âditeur d'Images Multi-Filtres</h1>
        
        <div class="main-area">
            <!-- Zone viewer centrale -->
            <div class="canvas-section">
                <div class="viewer-container">
                    <div class="images-grid" id="imagesGrid"></div>
                    <div class="upload-overlay" id="uploadOverlay">
                        <svg viewBox="0 0 24 24" fill="currentColor">
                            <path d="M9 16h6v-6h4l-7-7-7 7h4zm-4 2h14v2H5z"/>
                        </svg>
                        <button class="upload-btn" onclick="document.getElementById('fileInput').click()">
                            üìÅ Charger vos images (max 8)
                        </button>
                        <p style="font-size: 13px;">Toutes les images s'affichent ensemble !</p>
                    </div>
                </div>
                
                <div class="controls">
                    <button class="control-btn add-btn" onclick="document.getElementById('fileInput').click()">
                        ‚ûï Ajouter
                    </button>
                    <button class="control-btn clear-filter-btn" onclick="clearFilter()" id="clearFilterBtn" disabled>
                        üîÑ Effacer
                    </button>
                    <button class="control-btn download-all-btn" onclick="downloadAllAsZip()" id="downloadAllBtn" disabled>
                        üì¶ ZIP
                    </button>
                </div>
            </div>

            <!-- Panel de filtres √† droite -->
            <div class="filters-panel">
                <h2>Filtres disponibles</h2>
                <div class="info-badge">
                    Appliqu√© en temps r√©el sur toutes les images
                </div>
                <div class="current-filter-badge" id="currentFilterBadge" style="display: none;">
                    <span id="currentFilterName">Aucun</span>
                </div>
                
                <div class="filter-category">
                    <h3>üé≠ Basiques</h3>
                    <div class="filter-grid" id="basicFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üéÆ R√©tro Gaming</h3>
                    <div class="filter-grid" id="gamingFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üåà Vaporwave & Synthwave</h3>
                    <div class="filter-grid" id="vaporFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üå∏ Vintage & Pastel</h3>
                    <div class="filter-grid" id="vintageFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üé® Artistique</h3>
                    <div class="filter-grid" id="artisticFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üé¨ Cin√©ma</h3>
                    <div class="filter-grid" id="cinemaFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üåü Channels RGB</h3>
                    <div class="filter-grid" id="rgbFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üçÇ Saisons</h3>
                    <div class="filter-grid" id="seasonFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üé® Teintes (Hue)</h3>
                    <div class="filter-grid" id="hueFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üëª Sp√©ciaux</h3>
                    <div class="filter-grid" id="specialFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üåå Cosmique</h3>
                    <div class="filter-grid" id="cosmicFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üß™ Chimique</h3>
                    <div class="filter-grid" id="chemicalFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>üéÉ Horror</h3>
                    <div class="filter-grid" id="horrorFilters"></div>
                </div>

                <div class="filter-category">
                    <h3>ü§™ WTF & Exp√©rimental</h3>
                    <div class="filter-grid" id="wtfFilters"></div>
                </div>
            </div>
        </div>

        <input type="file" id="fileInput" accept="image/*" multiple>
    </div>

    <!-- JSZip library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

    <script>
        const fileInput = document.getElementById('fileInput');
        const uploadOverlay = document.getElementById('uploadOverlay');
        const imagesGrid = document.getElementById('imagesGrid');
        const currentFilterBadge = document.getElementById('currentFilterBadge');
        const currentFilterName = document.getElementById('currentFilterName');
        
        let loadedImages = [];
        let currentFilter = null;
        let activeFilterElement = null;

        // Configuration des filtres par cat√©gorie
        const filterCategories = {
            basicFilters: [
                { name: 'Noir et Blanc', filter: 'grayscale' },
                { name: 'S√©pia', filter: 'sepia' },
                { name: 'N√©gatif', filter: 'invert' },
                { name: 'Luminosit√©++', filter: 'brightness' },
                { name: 'Obscurit√©', filter: 'darkness' },
                { name: 'Contraste++', filter: 'contrast' }
            ],
            gamingFilters: [
                { name: 'Game Boy', filter: 'gameboy' },
                { name: 'Game Boy Green', filter: 'gameboyGreen' },
                { name: 'NES 8-bit', filter: 'nes' },
                { name: 'CGA PC', filter: 'cga' },
                { name: 'Atari 2600', filter: 'atari' },
                { name: 'Pixellis√©', filter: 'pixelate' }
            ],
            vaporFilters: [
                { name: 'Vaporwave', filter: 'vaporwave' },
                { name: 'Vaporwave Max', filter: 'vaporwavemax' },
                { name: 'Vaporwave Arc', filter: 'vaporwavearc' },
                { name: 'Synthwave', filter: 'synthwave' },
                { name: 'Cyberpunk', filter: 'cyberpunk' },
                { name: 'Miami Vice', filter: 'miami' },
                { name: 'N√©on', filter: 'neon' },
                { name: 'Outrun', filter: 'outrun' }
            ],
            vintageFilters: [
                { name: 'Vintage', filter: 'vintage' },
                { name: 'Polaroid', filter: 'polaroid' },
                { name: 'Pastel', filter: 'pastel' },
                { name: 'Chaleureux', filter: 'warm' },
                { name: 'Froid', filter: 'cold' },
                { name: 'R√©tro 70s', filter: 'retro70s' }
            ],
            artisticFilters: [
                { name: 'Poster', filter: 'posterize' },
                { name: 'Solarisation', filter: 'solarize' },
                { name: 'Contours', filter: 'edge' },
                { name: 'Relief', filter: 'emboss' },
                { name: 'Flou', filter: 'blur' },
                { name: 'Peinture', filter: 'painting' }
            ],
            cinemaFilters: [
                { name: 'Cin√©ma', filter: 'cinema' },
                { name: 'Film Noir', filter: 'noir' },
                { name: 'Technicolor', filter: 'technicolor' },
                { name: 'Bleach Bypass', filter: 'bleach' },
                { name: 'Western', filter: 'western' },
                { name: 'Sci-Fi', filter: 'scifi' }
            ],
            rgbFilters: [
                { name: 'Canal Rouge', filter: 'redChannel' },
                { name: 'Canal Vert', filter: 'greenChannel' },
                { name: 'Canal Bleu', filter: 'blueChannel' },
                { name: 'Glitch RGB', filter: 'rgbShift' },
                { name: 'Swap RB', filter: 'swapRB' },
                { name: 'Swap GB', filter: 'swapGB' }
            ],
            seasonFilters: [
                { name: 'Printemps', filter: 'spring' },
                { name: '√ât√©', filter: 'summer' },
                { name: 'Automne', filter: 'autumn' },
                { name: 'Hiver', filter: 'winter' }
            ],
            hueFilters: [
                { name: 'Hue +45¬∞', filter: 'hue45' },
                { name: 'Hue +90¬∞', filter: 'hue90' },
                { name: 'Hue +135¬∞', filter: 'hue135' },
                { name: 'Hue +180¬∞', filter: 'hue180' },
                { name: 'Hue +225¬∞', filter: 'hue225' },
                { name: 'Hue +270¬∞', filter: 'hue270' },
                { name: 'Hue +315¬∞', filter: 'hue315' },
                { name: 'Hue Rotatif', filter: 'hueRotate' }
            ],
            specialFilters: [
                { name: 'Silhouette', filter: 'silhouette' },
                { name: 'Noir/Blanc Pur', filter: 'binarize' },
                { name: 'Transparent BG', filter: 'transparentbg' },
                { name: 'Cartoon', filter: 'cartoon' },
                { name: 'Aquarelle', filter: 'watercolor' },
                { name: 'Crayon', filter: 'pencil' }
            ],
            cosmicFilters: [
                { name: 'Galaxie', filter: 'galaxy' },
                { name: 'N√©buleuse', filter: 'nebula' },
                { name: 'Supernova', filter: 'supernova' },
                { name: 'Trou Noir', filter: 'blackhole' },
                { name: 'Aurora', filter: 'aurora' },
                { name: 'Cosmic', filter: 'cosmic' }
            ],
            chemicalFilters: [
                { name: 'Radioactif', filter: 'radioactive' },
                { name: 'Acide', filter: 'acid' },
                { name: 'Toxique', filter: 'toxic' },
                { name: 'Uranium', filter: 'uranium' },
                { name: 'Biohazard', filter: 'biohazard' },
                { name: 'Plasma', filter: 'plasma' }
            ],
            horrorFilters: [
                { name: 'Zombie', filter: 'zombie' },
                { name: 'Corrompu', filter: 'corrupted' },
                { name: 'Sang', filter: 'blood' },
                { name: 'D√©mon', filter: 'demon' },
                { name: 'Cauchemar', filter: 'nightmare' },
                { name: 'Hant√©', filter: 'haunted' }
            ],
            wtfFilters: [
                { name: 'Psych√©d√©lique', filter: 'psychedelic' },
                { name: 'Infrarouge', filter: 'infrared' },
                { name: 'X-Ray', filter: 'xray' },
                { name: 'Thermique', filter: 'thermal' },
                { name: 'Matrix', filter: 'matrix' },
                { name: 'Deep Fry', filter: 'deepfry' },
                { name: 'Glitch Max', filter: 'glitchmax' },
                { name: 'Holographique', filter: 'holographic' },
                { name: 'JPEG Artifacts', filter: 'jpegify' },
                { name: 'Chromatic', filter: 'chromatic' },
                { name: 'Datamosh', filter: 'datamosh' },
                { name: 'VHS Glitch', filter: 'vhsglitch' },
                { name: 'Scanlines', filter: 'scanlines' },
                { name: 'Color Bleed', filter: 'colorbleed' },
                { name: 'Nuke', filter: 'nuke' },
                { name: 'Drunk', filter: 'drunk' },
                { name: 'Rave', filter: 'rave' },
                { name: 'Dimension X', filter: 'dimensionx' }
            ]
        };

        // Cr√©er les miniatures de preview
        function createFilterPreviews() {
            for (const [containerId, filters] of Object.entries(filterCategories)) {
                const container = document.getElementById(containerId);
                filters.forEach(filterInfo => {
                    const filterItem = document.createElement('div');
                    filterItem.className = 'filter-item';
                    filterItem.onclick = () => applyFilterToAll(filterInfo.filter, filterInfo.name, filterItem);

                    const preview = document.createElement('div');
                    preview.className = 'filter-preview';
                    preview.innerHTML = '<div class="no-image">üé®</div>';

                    const previewCanvas = document.createElement('canvas');
                    previewCanvas.style.display = 'none';
                    preview.appendChild(previewCanvas);

                    const name = document.createElement('div');
                    name.className = 'filter-name';
                    name.textContent = filterInfo.name;

                    filterItem.appendChild(preview);
                    filterItem.appendChild(name);
                    container.appendChild(filterItem);

                    filterInfo.previewCanvas = previewCanvas;
                    filterInfo.previewContainer = preview;
                    filterInfo.element = filterItem;
                });
            }
        }

        fileInput.addEventListener('change', function(e) {
            const files = Array.from(e.target.files);
            const remainingSlots = 8 - loadedImages.length;
            
            if (files.length > remainingSlots) {
                alert(`Vous ne pouvez charger que ${remainingSlots} image(s) suppl√©mentaire(s). Maximum 8 images.`);
                return;
            }

            files.forEach(file => {
                if (loadedImages.length >= 8) return;
                
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        canvas.width = img.width;
                        canvas.height = img.height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0);

                        loadedImages.push({
                            original: img,
                            canvas: canvas,
                            name: file.name
                        });

                        updateViewer();
                        
                        if (loadedImages.length === 1) {
                            uploadOverlay.style.display = 'none';
                            generatePreviews();
                        }

                        if (currentFilter) {
                            applyFilterToAll(currentFilter.filter, currentFilter.name, activeFilterElement, true);
                        }

                        updateButtons();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            });

            e.target.value = '';
        });

        function updateViewer() {
            imagesGrid.innerHTML = '';

            loadedImages.forEach((imgData, index) => {
                const card = document.createElement('div');
                card.className = 'image-card';

                const canvas = imgData.canvas;
                card.appendChild(canvas);

                const footer = document.createElement('div');
                footer.className = 'image-card-footer';

                const number = document.createElement('span');
                number.className = 'image-number';
                number.textContent = `#${index + 1}`;

                const removeBtn = document.createElement('button');
                removeBtn.className = 'remove-btn';
                removeBtn.textContent = '√ó';
                removeBtn.onclick = () => removeImage(index);

                footer.appendChild(number);
                footer.appendChild(removeBtn);
                card.appendChild(footer);

                imagesGrid.appendChild(card);
            });
        }

        function removeImage(index) {
            loadedImages.splice(index, 1);
            
            if (loadedImages.length === 0) {
                uploadOverlay.style.display = 'flex';
                currentFilter = null;
                activeFilterElement = null;
                currentFilterBadge.style.display = 'none';
            } else {
                generatePreviews();
            }
            
            updateViewer();
            updateButtons();
        }

        function generatePreviews() {
            if (loadedImages.length === 0) return;

            const previewSize = 120;
            const imgData = loadedImages[0];
            
            for (const filters of Object.values(filterCategories)) {
                filters.forEach(filterInfo => {
                    const previewCanvas = filterInfo.previewCanvas;
                    const container = filterInfo.previewContainer;
                    
                    const aspectRatio = imgData.original.width / imgData.original.height;
                    if (aspectRatio > 1) {
                        previewCanvas.width = previewSize;
                        previewCanvas.height = previewSize / aspectRatio;
                    } else {
                        previewCanvas.height = previewSize;
                        previewCanvas.width = previewSize * aspectRatio;
                    }

                    const previewCtx = previewCanvas.getContext('2d');
                    previewCtx.drawImage(imgData.original, 0, 0, previewCanvas.width, previewCanvas.height);

                    const imageData = previewCtx.getImageData(0, 0, previewCanvas.width, previewCanvas.height);
                    applyFilterToImageData(imageData, filterInfo.filter, previewCanvas);
                    previewCtx.putImageData(imageData, 0, 0);

                    container.querySelector('.no-image').style.display = 'none';
                    previewCanvas.style.display = 'block';
                });
            }
        }

        function applyFilterToAll(filterName, displayName, element, skipStateUpdate = false) {
            if (loadedImages.length === 0) return;

            if (!skipStateUpdate) {
                currentFilter = { filter: filterName, name: displayName };
                
                if (activeFilterElement) {
                    activeFilterElement.classList.remove('active');
                }
                activeFilterElement = element;
                element.classList.add('active');

                currentFilterBadge.style.display = 'block';
                currentFilterName.textContent = displayName;
            }

            loadedImages.forEach(imgData => {
                const ctx = imgData.canvas.getContext('2d');
                ctx.drawImage(imgData.original, 0, 0);
                
                const imageData = ctx.getImageData(0, 0, imgData.canvas.width, imgData.canvas.height);
                applyFilterToImageData(imageData, filterName, imgData.canvas);
                ctx.putImageData(imageData, 0, 0);
            });

            updateButtons();
        }

        function clearFilter() {
            if (loadedImages.length === 0) return;

            currentFilter = null;
            
            if (activeFilterElement) {
                activeFilterElement.classList.remove('active');
                activeFilterElement = null;
            }

            currentFilterBadge.style.display = 'none';

            loadedImages.forEach(imgData => {
                const ctx = imgData.canvas.getContext('2d');
                ctx.clearRect(0, 0, imgData.canvas.width, imgData.canvas.height);
                ctx.drawImage(imgData.original, 0, 0);
            });

            updateButtons();
        }

        async function downloadAllAsZip() {
            if (loadedImages.length === 0) return;

            const zip = new JSZip();
            const filterSuffix = currentFilter ? `_${currentFilter.filter}` : '_original';

            for (let i = 0; i < loadedImages.length; i++) {
                const imgData = loadedImages[i];
                const blob = await new Promise(resolve => {
                    imgData.canvas.toBlob(resolve, 'image/png');
                });

                const filename = imgData.name.replace(/\.[^/.]+$/, '') + filterSuffix + '.png';
                zip.file(filename, blob);
            }

            const content = await zip.generateAsync({ type: 'blob' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(content);
            link.download = `images${filterSuffix}_${Date.now()}.zip`;
            link.click();
        }

        function updateButtons() {
            const hasImages = loadedImages.length > 0;
            const hasFilter = currentFilter !== null;
            document.getElementById('downloadAllBtn').disabled = !hasImages;
            document.getElementById('clearFilterBtn').disabled = !hasFilter;
        }

        // Fonction centrale pour appliquer les filtres
        function applyFilterToImageData(imageData, filterName, targetCanvas) {
            const data = imageData.data;

            switch(filterName) {
                // Basiques
                case 'grayscale': grayscale(data); break;
                case 'sepia': sepia(data); break;
                case 'invert': invert(data); break;
                case 'brightness': brightness(data, 50); break;
                case 'darkness': brightness(data, -50); break;
                case 'contrast': contrast(data, 40); break;
                // Gaming
                case 'gameboy': gameboy(data); break;
                case 'gameboyGreen': gameboyGreen(data); break;
                case 'nes': nes(data); break;
                case 'cga': cga(data); break;
                case 'atari': atari(data); break;
                case 'pixelate': pixelateData(imageData, targetCanvas); return;
                // Vaporwave
                case 'vaporwave': vaporwave(data); break;
                case 'vaporwavemax': vaporwavemax(data); break;
                case 'vaporwavearc': vaporwavearc(data); break;
                case 'synthwave': synthwave(data); break;
                case 'cyberpunk': cyberpunk(data); break;
                case 'miami': miami(data); break;
                case 'neon': neon(data); break;
                case 'outrun': outrun(data); break;
                // Vintage
                case 'vintage': vintage(data); break;
                case 'polaroid': polaroid(data); break;
                case 'pastel': pastel(data); break;
                case 'warm': warm(data); break;
                case 'cold': cold(data); break;
                case 'retro70s': retro70s(data); break;
                // Artistique
                case 'posterize': posterize(data, 4); break;
                case 'solarize': solarize(data); break;
                case 'edge': edgeData(imageData, targetCanvas); return;
                case 'emboss': embossData(imageData, targetCanvas); return;
                case 'blur': blurData(imageData, targetCanvas); return;
                case 'painting': painting(data); break;
                // Cin√©ma
                case 'cinema': cinema(data); break;
                case 'noir': noir(data); break;
                case 'technicolor': technicolor(data); break;
                case 'bleach': bleach(data); break;
                case 'western': western(data); break;
                case 'scifi': scifi(data); break;
                // RGB
                case 'redChannel': redChannel(data); break;
                case 'greenChannel': greenChannel(data); break;
                case 'blueChannel': blueChannel(data); break;
                case 'rgbShift': rgbShiftData(imageData, targetCanvas); return;
                case 'swapRB': swapRB(data); break;
                case 'swapGB': swapGB(data); break;
                // Saisons
                case 'spring': spring(data); break;
                case 'summer': summer(data); break;
                case 'autumn': autumn(data); break;
                case 'winter': winter(data); break;
                // Hue
                case 'hue45': hueShift(data, 45); break;
                case 'hue90': hueShift(data, 90); break;
                case 'hue135': hueShift(data, 135); break;
                case 'hue180': hueShift(data, 180); break;
                case 'hue225': hueShift(data, 225); break;
                case 'hue270': hueShift(data, 270); break;
                case 'hue315': hueShift(data, 315); break;
                case 'hueRotate': hueRotateGradient(data); break;
                // Sp√©ciaux
                case 'silhouette': silhouette(data); break;
                case 'binarize': binarize(data); break;
                case 'transparentbg': transparentbg(data); break;
                case 'cartoon': cartoon(data); break;
                case 'watercolor': watercolor(data); break;
                case 'pencil': pencil(data); break;
                // Cosmique
                case 'galaxy': galaxy(data); break;
                case 'nebula': nebula(data); break;
                case 'supernova': supernova(data); break;
                case 'blackhole': blackhole(data); break;
                case 'aurora': aurora(data); break;
                case 'cosmic': cosmic(data); break;
                // Chimique
                case 'radioactive': radioactive(data); break;
                case 'acid': acid(data); break;
                case 'toxic': toxic(data); break;
                case 'uranium': uranium(data); break;
                case 'biohazard': biohazard(data); break;
                case 'plasma': plasma(data); break;
                // Horror
                case 'zombie': zombie(data); break;
                case 'corrupted': corrupted(data); break;
                case 'blood': blood(data); break;
                case 'demon': demon(data); break;
                case 'nightmare': nightmare(data); break;
                case 'haunted': haunted(data); break;
                // WTF
                case 'psychedelic': psychedelic(data); break;
                case 'infrared': infrared(data); break;
                case 'xray': xray(data); break;
                case 'thermal': thermal(data); break;
                case 'matrix': matrix(data); break;
                case 'deepfry': deepfry(data); break;
                case 'glitchmax': glitchmax(data); break;
                case 'holographic': holographic(data); break;
                case 'jpegify': jpegify(data); break;
                case 'chromatic': chromaticAberration(imageData, targetCanvas); return;
                case 'datamosh': datamosh(data); break;
                case 'vhsglitch': vhsglitch(data); break;
                case 'scanlines': scanlines(data, targetCanvas); break;
                case 'colorbleed': colorbleed(data); break;
                case 'nuke': nuke(data); break;
                case 'drunk': drunk(data); break;
                case 'rave': rave(data); break;
                case 'dimensionx': dimensionx(data); break;
            }
        }

        // ===== FILTRES BASIQUES =====
        function grayscale(data) {
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = data[i + 1] = data[i + 2] = avg;
            }
        }

        function sepia(data) {
            for (let i = 0; i < data.length; i += 4) {
                const r = data[i], g = data[i + 1], b = data[i + 2];
                data[i] = Math.min(255, r * 0.393 + g * 0.769 + b * 0.189);
                data[i + 1] = Math.min(255, r * 0.349 + g * 0.686 + b * 0.168);
                data[i + 2] = Math.min(255, r * 0.272 + g * 0.534 + b * 0.131);
            }
        }

        function invert(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 255 - data[i];
                data[i + 1] = 255 - data[i + 1];
                data[i + 2] = 255 - data[i + 2];
            }
        }

        function brightness(data, value) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, Math.max(0, data[i] + value));
                data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + value));
                data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + value));
            }
        }

        function contrast(data, value) {
            const factor = (259 * (value + 255)) / (255 * (259 - value));
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, Math.max(0, factor * (data[i] - 128) + 128));
                data[i + 1] = Math.min(255, Math.max(0, factor * (data[i + 1] - 128) + 128));
                data[i + 2] = Math.min(255, Math.max(0, factor * (data[i + 2] - 128) + 128));
            }
        }

        // ===== GAMING =====
        function gameboy(data) {
            const palette = [[15, 56, 15], [48, 98, 48], [139, 172, 15], [155, 188, 15]];
            for (let i = 0; i < data.length; i += 4) {
                const gray = (data[i] + data[i + 1] + data[i + 2]) / 3;
                const color = palette[Math.min(Math.floor(gray / 64), 3)];
                data[i] = color[0]; data[i + 1] = color[1]; data[i + 2] = color[2];
            }
        }

        function gameboyGreen(data) {
            grayscale(data);
            for (let i = 0; i < data.length; i += 4) {
                const gray = data[i];
                data[i] = gray * 0.3; data[i + 1] = gray * 0.8; data[i + 2] = gray * 0.3;
            }
        }

        function nes(data) {
            const palette = [[0, 0, 0], [252, 252, 252], [188, 188, 188], [0, 88, 248], [0, 168, 0], [216, 0, 204], [228, 92, 16], [248, 56, 0]];
            applyPalette(data, palette);
        }

        function cga(data) {
            const palette = [[0, 0, 0], [0, 170, 170], [170, 0, 170], [170, 170, 170], [255, 85, 255], [85, 255, 255], [255, 255, 85], [255, 255, 255]];
            applyPalette(data, palette);
        }

        function atari(data) {
            const palette = [[0, 0, 0], [68, 68, 0], [112, 40, 0], [132, 24, 0], [136, 0, 0], [120, 0, 92], [72, 0, 120], [20, 0, 132]];
            applyPalette(data, palette);
        }

        function applyPalette(data, palette) {
            for (let i = 0; i < data.length; i += 4) {
                let closest = 0, minDist = Infinity;
                for (let j = 0; j < palette.length; j++) {
                    const dist = Math.sqrt(Math.pow(data[i] - palette[j][0], 2) + Math.pow(data[i + 1] - palette[j][1], 2) + Math.pow(data[i + 2] - palette[j][2], 2));
                    if (dist < minDist) { minDist = dist; closest = j; }
                }
                data[i] = palette[closest][0]; data[i + 1] = palette[closest][1]; data[i + 2] = palette[closest][2];
            }
        }

        function pixelateData(imageData, targetCanvas) {
            const size = 10;
            const w = targetCanvas.width, h = targetCanvas.height;
            const tempCtx = targetCanvas.getContext('2d');
            tempCtx.imageSmoothingEnabled = false;
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = w / size; tempCanvas.height = h / size;
            const tempContext = tempCanvas.getContext('2d');
            tempContext.drawImage(targetCanvas, 0, 0, w, h, 0, 0, w / size, h / size);
            tempCtx.drawImage(tempCanvas, 0, 0, w / size, h / size, 0, 0, w, h);
        }

        // ===== VAPORWAVE =====
        function vaporwave(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.2 + 50);
                data[i + 1] = Math.min(255, data[i + 1] * 0.8);
                data[i + 2] = Math.min(255, data[i + 2] * 1.3 + 60);
            }
        }

        function vaporwavemax(data) {
            hueShift(data, 300);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.5 + 80);
                data[i + 1] = Math.min(255, data[i + 1] * 0.7);
                data[i + 2] = Math.min(255, data[i + 2] * 1.8 + 100);
            }
            contrast(data, 50);
        }

        function vaporwavearc(data) {
            for (let i = 0; i < data.length; i += 4) {
                const position = (i / data.length) * 6.28;
                const wave = Math.sin(position) * 0.5 + 0.5;
                
                data[i] = Math.min(255, data[i] * (0.3 + wave * 0.7) + 80);
                data[i + 1] = Math.min(255, data[i + 1] * 0.6 + 40);
                data[i + 2] = Math.min(255, data[i + 2] * (1.2 + wave * 0.8) + 100);
            }
            contrast(data, 40);
        }

        function synthwave(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.4);
                data[i + 1] = Math.min(255, data[i + 1] * 0.5);
                data[i + 2] = Math.min(255, data[i + 2] * 1.5);
            }
        }

        function cyberpunk(data) {
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                if (avg > 128) {
                    data[i] = Math.min(255, data[i] * 1.3);
                    data[i + 1] = Math.min(255, data[i + 1] * 0.7);
                    data[i + 2] = Math.min(255, data[i + 2] * 1.5);
                } else {
                    data[i] *= 0.5;
                    data[i + 1] = Math.min(255, data[i + 1] * 1.3);
                    data[i + 2] = Math.min(255, data[i + 2] * 1.3);
                }
            }
        }

        function miami(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.3 + 20);
                data[i + 1] = Math.min(255, data[i + 1] * 0.9 + 30);
                data[i + 2] = Math.min(255, data[i + 2] * 1.4);
            }
        }

        function neon(data) {
            contrast(data, 60);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.5);
                data[i + 1] = Math.min(255, data[i + 1] * 1.3);
                data[i + 2] = Math.min(255, data[i + 2] * 1.6);
            }
        }

        function outrun(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.6 + 100);
                data[i + 1] = Math.min(255, data[i + 1] * 0.4);
                data[i + 2] = Math.min(255, data[i + 2] * 1.7 + 80);
            }
            contrast(data, 50);
        }

        // ===== VINTAGE =====
        function vintage(data) {
            sepia(data);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.max(0, data[i] - 20);
                data[i + 1] = Math.max(0, data[i + 1] - 10);
                data[i + 2] = Math.max(0, data[i + 2] - 30);
            }
        }

        function polaroid(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.1 + 20);
                data[i + 1] = Math.min(255, data[i + 1] * 1.05 + 15);
                data[i + 2] = Math.min(255, data[i + 2] * 0.95);
            }
        }

        function pastel(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = (data[i] + 255) / 2;
                data[i + 1] = (data[i + 1] + 255) / 2;
                data[i + 2] = (data[i + 2] + 255) / 2;
            }
        }

        function warm(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] + 30);
                data[i + 1] = Math.min(255, data[i + 1] + 10);
                data[i + 2] = Math.max(0, data[i + 2] - 20);
            }
        }

        function cold(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.max(0, data[i] - 20);
                data[i + 1] = Math.min(255, data[i + 1] + 10);
                data[i + 2] = Math.min(255, data[i + 2] + 30);
            }
        }

        function retro70s(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.3 + 40);
                data[i + 1] = Math.min(255, data[i + 1] * 1.2 + 20);
                data[i + 2] = Math.max(0, data[i + 2] * 0.7 - 10);
            }
            contrast(data, 20);
        }

        // ===== ARTISTIQUE =====
        function posterize(data, levels) {
            const step = 255 / levels;
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.floor(data[i] / step) * step;
                data[i + 1] = Math.floor(data[i + 1] / step) * step;
                data[i + 2] = Math.floor(data[i + 2] / step) * step;
            }
        }

        function solarize(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = data[i] < 128 ? data[i] : 255 - data[i];
                data[i + 1] = data[i + 1] < 128 ? data[i + 1] : 255 - data[i + 1];
                data[i + 2] = data[i + 2] < 128 ? data[i + 2] : 255 - data[i + 2];
            }
        }

        function edgeData(imageData, targetCanvas) {
            applyKernel(imageData, targetCanvas, [-1, -1, -1, -1, 8, -1, -1, -1, -1], 0);
        }

        function embossData(imageData, targetCanvas) {
            applyKernel(imageData, targetCanvas, [-2, -1, 0, -1, 1, 1, 0, 1, 2], 128);
        }

        function applyKernel(imageData, targetCanvas, kernel, offset) {
            const data = imageData.data;
            const w = targetCanvas.width, h = targetCanvas.height;
            const output = new Uint8ClampedArray(data);
            
            for (let y = 1; y < h - 1; y++) {
                for (let x = 1; x < w - 1; x++) {
                    let r = 0, g = 0, b = 0;
                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            const idx = ((y + ky) * w + (x + kx)) * 4;
                            const k = kernel[(ky + 1) * 3 + (kx + 1)];
                            r += data[idx] * k;
                            g += data[idx + 1] * k;
                            b += data[idx + 2] * k;
                        }
                    }
                    const idx = (y * w + x) * 4;
                    output[idx] = Math.min(255, Math.max(0, r + offset));
                    output[idx + 1] = Math.min(255, Math.max(0, g + offset));
                    output[idx + 2] = Math.min(255, Math.max(0, b + offset));
                }
            }
            
            for (let i = 0; i < data.length; i++) data[i] = output[i];
        }

        function blurData(imageData, targetCanvas) {
            const data = imageData.data;
            const w = targetCanvas.width, h = targetCanvas.height;
            const output = new Uint8ClampedArray(data);
            
            for (let y = 1; y < h - 1; y++) {
                for (let x = 1; x < w - 1; x++) {
                    let r = 0, g = 0, b = 0, count = 0;
                    for (let ky = -1; ky <= 1; ky++) {
                        for (let kx = -1; kx <= 1; kx++) {
                            const idx = ((y + ky) * w + (x + kx)) * 4;
                            r += data[idx]; g += data[idx + 1]; b += data[idx + 2]; count++;
                        }
                    }
                    const idx = (y * w + x) * 4;
                    output[idx] = r / count; output[idx + 1] = g / count; output[idx + 2] = b / count;
                }
            }
            
            for (let i = 0; i < data.length; i++) data[i] = output[i];
        }

        function painting(data) {
            posterize(data, 6);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.2);
                data[i + 1] = Math.min(255, data[i + 1] * 1.2);
                data[i + 2] = Math.min(255, data[i + 2] * 1.2);
            }
        }

        // ===== CINEMA =====
        function cinema(data) {
            for (let i = 0; i < data.length; i += 4) {
                const avg = data[i] * 0.3 + data[i + 1] * 0.59 + data[i + 2] * 0.11;
                data[i] = Math.min(255, avg * 1.2 - 10);
                data[i + 1] = Math.min(255, avg * 1.1 - 20);
                data[i + 2] = Math.min(255, avg * 0.9);
            }
        }

        function noir(data) {
            grayscale(data);
            contrast(data, 50);
            brightness(data, -20);
        }

        function technicolor(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.3);
                data[i + 1] = Math.min(255, data[i + 1] * 1.1);
                data[i + 2] = Math.min(255, data[i + 2] * 1.2);
            }
            contrast(data, 30);
        }

        function bleach(data) {
            grayscale(data);
            for (let i = 0; i < data.length; i += 4) {
                const gray = data[i];
                data[i] = Math.min(255, gray * 0.9 + 30);
                data[i + 1] = Math.min(255, gray * 0.95 + 20);
                data[i + 2] = Math.min(255, gray * 0.85 + 40);
            }
            contrast(data, 50);
        }

        function western(data) {
            sepia(data);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.3);
                data[i + 1] = Math.min(255, data[i + 1] * 1.1);
                data[i + 2] = Math.max(0, data[i + 2] * 0.7);
            }
            contrast(data, 40);
            brightness(data, -15);
        }

        function scifi(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 0.8);
                data[i + 1] = Math.min(255, data[i + 1] * 1.1 + 20);
                data[i + 2] = Math.min(255, data[i + 2] * 1.4 + 40);
            }
            contrast(data, 45);
        }

        // ===== RGB =====
        function redChannel(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i + 1] = 0; data[i + 2] = 0;
            }
        }

        function greenChannel(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 0; data[i + 2] = 0;
            }
        }

        function blueChannel(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 0; data[i + 1] = 0;
            }
        }

        function rgbShiftData(imageData, targetCanvas) {
            const data = imageData.data;
            const w = targetCanvas.width, h = targetCanvas.height;
            const shift = 5;
            const output = new Uint8ClampedArray(data);
            
            for (let y = 0; y < h; y++) {
                for (let x = 0; x < w; x++) {
                    const idx = (y * w + x) * 4;
                    const idxShift = (y * w + Math.min(w - 1, x + shift)) * 4;
                    output[idx] = data[idxShift];
                    output[idx + 1] = data[idx + 1];
                    output[idx + 2] = data[Math.max(0, (y * w + x - shift) * 4) + 2];
                }
            }
            
            for (let i = 0; i < data.length; i++) data[i] = output[i];
        }

        function swapRB(data) {
            for (let i = 0; i < data.length; i += 4) {
                [data[i], data[i + 2]] = [data[i + 2], data[i]];
            }
        }

        function swapGB(data) {
            for (let i = 0; i < data.length; i += 4) {
                [data[i + 1], data[i + 2]] = [data[i + 2], data[i + 1]];
            }
        }

        // ===== SAISONS =====
        function spring(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.05 + 15);
                data[i + 1] = Math.min(255, data[i + 1] * 1.2 + 30);
                data[i + 2] = Math.min(255, data[i + 2] * 0.95 + 20);
            }
        }

        function summer(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.3 + 40);
                data[i + 1] = Math.min(255, data[i + 1] * 1.2 + 30);
                data[i + 2] = Math.min(255, data[i + 2] * 0.9);
            }
            brightness(data, 20);
        }

        function autumn(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.4 + 50);
                data[i + 1] = Math.min(255, data[i + 1] * 1.1 + 20);
                data[i + 2] = Math.max(0, data[i + 2] * 0.6 - 30);
            }
        }

        function winter(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 0.9 + 40);
                data[i + 1] = Math.min(255, data[i + 1] * 0.95 + 40);
                data[i + 2] = Math.min(255, data[i + 2] * 1.3 + 60);
            }
            brightness(data, 30);
        }

        // ===== HUE =====
        function rgbToHsl(r, g, b) {
            r /= 255; g /= 255; b /= 255;
            const max = Math.max(r, g, b), min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            return [h * 360, s * 100, l * 100];
        }

        function hslToRgb(h, s, l) {
            h /= 360; s /= 100; l /= 100;
            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];
        }

        function hueShift(data, degrees) {
            for (let i = 0; i < data.length; i += 4) {
                const [h, s, l] = rgbToHsl(data[i], data[i + 1], data[i + 2]);
                const newH = (h + degrees) % 360;
                const [r, g, b] = hslToRgb(newH, s, l);
                data[i] = r;
                data[i + 1] = g;
                data[i + 2] = b;
            }
        }

        function hueRotateGradient(data) {
            for (let i = 0; i < data.length; i += 4) {
                const position = i / data.length;
                const degrees = position * 360;
                const [h, s, l] = rgbToHsl(data[i], data[i + 1], data[i + 2]);
                const newH = (h + degrees) % 360;
                const [r, g, b] = hslToRgb(newH, s, l);
                data[i] = r;
                data[i + 1] = g;
                data[i + 2] = b;
            }
        }

        // ===== SPECIAUX =====
        function silhouette(data) {
            for (let i = 0; i < data.length; i += 4) {
                if (data[i + 3] > 0) {
                    data[i] = 0;
                    data[i + 1] = 0;
                    data[i + 2] = 0;
                }
            }
        }

        function binarize(data) {
            for (let i = 0; i < data.length; i += 4) {
                const avg = (data[i] + data[i + 1] + data[i + 2]) / 3;
                const val = avg > 127 ? 255 : 0;
                data[i] = data[i + 1] = data[i + 2] = val;
            }
        }

        function transparentbg(data) {
            for (let i = 0; i < data.length; i += 4) {
                const brightness = (data[i] + data[i + 1] + data[i + 2]) / 3;
                if (brightness > 200) {
                    data[i + 3] = 0;
                }
            }
        }

        function cartoon(data) {
            posterize(data, 5);
            contrast(data, 50);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.3);
                data[i + 1] = Math.min(255, data[i + 1] * 1.3);
                data[i + 2] = Math.min(255, data[i + 2] * 1.3);
            }
        }

        function watercolor(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = (data[i] + 200) / 2;
                data[i + 1] = (data[i + 1] + 200) / 2;
                data[i + 2] = (data[i + 2] + 200) / 2;
            }
            posterize(data, 8);
        }

        function pencil(data) {
            grayscale(data);
            invert(data);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 0.8 + 40);
                data[i + 1] = Math.min(255, data[i + 1] * 0.8 + 40);
                data[i + 2] = Math.min(255, data[i + 2] * 0.8 + 40);
            }
        }

        // ===== COSMIQUE =====
        function galaxy(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave = Math.sin(i * 0.003) * 100;
                data[i] = Math.min(255, data[i] * 0.5 + wave + 100);
                data[i + 1] = Math.min(255, data[i + 1] * 0.3 + wave * 0.5);
                data[i + 2] = Math.min(255, data[i + 2] * 1.5 + wave + 150);
            }
        }

        function nebula(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave1 = Math.sin(i * 0.002) * 80;
                const wave2 = Math.cos(i * 0.003) * 60;
                data[i] = Math.min(255, data[i] * 1.2 + wave1 + 100);
                data[i + 1] = Math.min(255, data[i + 1] * 0.6 + wave2);
                data[i + 2] = Math.min(255, data[i + 2] * 1.4 + wave1 + 120);
            }
        }

        function supernova(data) {
            for (let i = 0; i < data.length; i += 4) {
                const intensity = (data[i] + data[i + 1] + data[i + 2]) / 3;
                const boost = Math.pow(intensity / 255, 0.4) * 300;
                data[i] = Math.min(255, boost);
                data[i + 1] = Math.min(255, boost * 0.8);
                data[i + 2] = Math.min(255, boost * 0.6);
            }
        }

        function blackhole(data) {
            grayscale(data);
            invert(data);
            for (let i = 0; i < data.length; i += 4) {
                const intensity = data[i];
                data[i] = Math.max(0, intensity * 0.3);
                data[i + 1] = Math.max(0, intensity * 0.2);
                data[i + 2] = Math.max(0, intensity * 0.5);
            }
            contrast(data, 80);
        }

        function aurora(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave = Math.sin(i * 0.001) * 100;
                data[i] = Math.min(255, data[i] * 0.4 + wave * 0.3);
                data[i + 1] = Math.min(255, data[i + 1] * 1.3 + wave + 80);
                data[i + 2] = Math.min(255, data[i + 2] * 1.2 + wave * 0.8 + 60);
            }
        }

        function cosmic(data) {
            hueRotateGradient(data);
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.5);
                data[i + 1] = Math.min(255, data[i + 1] * 1.5);
                data[i + 2] = Math.min(255, data[i + 2] * 1.8);
            }
            contrast(data, 60);
        }

        // ===== CHIMIQUE =====
        function radioactive(data) {
            for (let i = 0; i < data.length; i += 4) {
                const intensity = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = Math.min(255, intensity * 0.3);
                data[i + 1] = Math.min(255, intensity * 2);
                data[i + 2] = Math.min(255, intensity * 0.3);
            }
            contrast(data, 70);
        }

        function acid(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = (data[i] + data[i + 2]) % 256;
                data[i + 1] = (data[i + 1] + data[i]) % 256;
                data[i + 2] = (data[i + 2] + data[i + 1]) % 256;
            }
            contrast(data, 80);
        }

        function toxic(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 0.5 + 50);
                data[i + 1] = Math.min(255, data[i + 1] * 1.8 + 100);
                data[i + 2] = Math.min(255, data[i + 2] * 0.3);
            }
        }

        function uranium(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave = Math.sin(i * 0.005) * 50;
                data[i] = Math.min(255, data[i] * 0.4 + wave);
                data[i + 1] = Math.min(255, data[i + 1] * 2 + 80);
                data[i + 2] = Math.min(255, data[i + 2] * 0.2);
            }
        }

        function biohazard(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.1 + 60);
                data[i + 1] = Math.min(255, data[i + 1] * 1.5 + 80);
                data[i + 2] = Math.min(255, data[i + 2] * 0.3);
            }
            contrast(data, 50);
        }

        function plasma(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave1 = Math.sin(i * 0.004) * 128;
                const wave2 = Math.cos(i * 0.003) * 128;
                data[i] = Math.min(255, Math.abs(wave1 + wave2) + 100);
                data[i + 1] = Math.min(255, Math.abs(wave1 * 0.5) + 50);
                data[i + 2] = Math.min(255, Math.abs(wave2) + 150);
            }
        }

        // ===== HORROR =====
        function zombie(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 0.8 + 40);
                data[i + 1] = Math.min(255, data[i + 1] * 1.1 + 30);
                data[i + 2] = Math.max(0, data[i + 2] * 0.5 - 20);
            }
            contrast(data, 30);
            brightness(data, -10);
        }

        function corrupted(data) {
            for (let i = 0; i < data.length; i += 20) {
                if (Math.random() > 0.7) {
                    const corruption = Math.floor(Math.random() * 150);
                    for (let j = 0; j < corruption && i + j < data.length; j += 4) {
                        data[i + j] = Math.random() * 255;
                        data[i + j + 1] = Math.random() * 255;
                        data[i + j + 2] = Math.random() * 255;
                    }
                }
            }
        }

        function blood(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.6 + 80);
                data[i + 1] = Math.max(0, data[i + 1] * 0.3 - 30);
                data[i + 2] = Math.max(0, data[i + 2] * 0.3 - 30);
            }
            contrast(data, 50);
        }

        function demon(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.8 + 100);
                data[i + 1] = Math.max(0, data[i + 1] * 0.2);
                data[i + 2] = Math.max(0, data[i + 2] * 0.2);
            }
            invert(data);
            contrast(data, 70);
        }

        function nightmare(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave = Math.sin(i * 0.01) * 100;
                data[i] = Math.min(255, data[i] * 0.5 + wave);
                data[i + 1] = Math.max(0, data[i + 1] * 0.3 - 50);
                data[i + 2] = Math.min(255, data[i + 2] * 0.8 + wave * 0.5);
            }
            contrast(data, 60);
        }

        function haunted(data) {
            grayscale(data);
            for (let i = 0; i < data.length; i += 4) {
                const gray = data[i];
                data[i] = Math.min(255, gray * 0.7 + 30);
                data[i + 1] = Math.min(255, gray * 0.8 + 50);
                data[i + 2] = Math.min(255, gray * 0.9 + 70);
            }
            contrast(data, 40);
            brightness(data, -30);
        }

        // ===== WTF =====
        function psychedelic(data) {
            for (let i = 0; i < data.length; i += 4) {
                const offset = Math.sin(i * 0.01) * 128;
                data[i] = Math.min(255, Math.max(0, (data[i] + offset) % 256));
                data[i + 1] = Math.min(255, Math.max(0, (data[i + 1] + offset + 85) % 256));
                data[i + 2] = Math.min(255, Math.max(0, (data[i + 2] + offset + 170) % 256));
            }
        }

        function infrared(data) {
            for (let i = 0; i < data.length; i += 4) {
                const temp = data[i + 1];
                data[i] = Math.min(255, temp * 1.5);
                data[i + 1] = Math.max(0, data[i] * 0.3);
                data[i + 2] = Math.max(0, data[i + 2] * 0.3);
            }
        }

        function xray(data) {
            invert(data);
            grayscale(data);
            contrast(data, 60);
            brightness(data, 40);
        }

        function thermal(data) {
            for (let i = 0; i < data.length; i += 4) {
                const intensity = (data[i] + data[i + 1] + data[i + 2]) / 3;
                if (intensity < 64) {
                    data[i] = 0; data[i + 1] = 0; data[i + 2] = intensity * 4;
                } else if (intensity < 128) {
                    data[i] = 0; data[i + 1] = (intensity - 64) * 4; data[i + 2] = 255;
                } else if (intensity < 192) {
                    data[i] = (intensity - 128) * 4; data[i + 1] = 255; data[i + 2] = 255 - (intensity - 128) * 4;
                } else {
                    data[i] = 255; data[i + 1] = 255 - (intensity - 192) * 4; data[i + 2] = 0;
                }
            }
        }

        function matrix(data) {
            for (let i = 0; i < data.length; i += 4) {
                const green = (data[i] + data[i + 1] + data[i + 2]) / 3;
                data[i] = 0;
                data[i + 1] = Math.min(255, green * 1.5);
                data[i + 2] = 0;
            }
            contrast(data, 50);
            brightness(data, -30);
        }

        function deepfry(data) {
            for (let i = 0; i < data.length; i += 4) {
                data[i] = Math.min(255, data[i] * 1.8);
                data[i + 1] = Math.min(255, data[i + 1] * 1.5);
                data[i + 2] = Math.min(255, data[i + 2] * 0.7);
            }
            contrast(data, 80);
            posterize(data, 3);
        }

        function glitchmax(data) {
            for (let i = 0; i < data.length; i += 16) {
                if (Math.random() > 0.7) {
                    const shift = Math.floor(Math.random() * 100) * 4;
                    const targetIdx = Math.min(data.length - 4, i + shift);
                    [data[i], data[targetIdx]] = [data[targetIdx], data[i]];
                    [data[i + 1], data[targetIdx + 1]] = [data[targetIdx + 1], data[i + 1]];
                    [data[i + 2], data[targetIdx + 2]] = [data[targetIdx + 2], data[i + 2]];
                }
            }
        }

        function holographic(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave = Math.sin(i * 0.005) * 50;
                data[i] = Math.min(255, Math.max(0, data[i] + wave));
                data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + wave * 1.5));
                data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + wave * 2));
            }
        }

        function jpegify(data) {
            posterize(data, 5);
            for (let i = 0; i < data.length; i += 4) {
                if (Math.random() > 0.95) {
                    data[i] = Math.min(255, data[i] + (Math.random() - 0.5) * 50);
                    data[i + 1] = Math.min(255, data[i + 1] + (Math.random() - 0.5) * 50);
                    data[i + 2] = Math.min(255, data[i + 2] + (Math.random() - 0.5) * 50);
                }
            }
        }

        function chromaticAberration(imageData, targetCanvas) {
            const data = imageData.data;
            const offset = 8;
            const output = new Uint8ClampedArray(data);
            
            for (let i = 0; i < data.length; i += 4) {
                const leftR = Math.max(0, i - offset * 4);
                const rightB = Math.min(data.length - 4, i + offset * 4);
                
                output[i] = data[leftR];
                output[i + 1] = data[i + 1];
                output[i + 2] = data[rightB + 2];
            }
            
            for (let i = 0; i < data.length; i++) data[i] = output[i];
        }

        function datamosh(data) {
            for (let i = 0; i < data.length; i += 40) {
                if (Math.random() > 0.5) {
                    const blockSize = Math.floor(Math.random() * 200);
                    for (let j = 0; j < blockSize && i + j < data.length; j += 4) {
                        data[i + j] = data[Math.max(0, i - 4)];
                        data[i + j + 1] = data[Math.max(0, i - 3)];
                        data[i + j + 2] = data[Math.max(0, i - 2)];
                    }
                }
            }
        }

        function vhsglitch(data) {
            for (let i = 0; i < data.length; i += 4) {
                if (Math.random() > 0.98) {
                    const glitchLength = Math.floor(Math.random() * 500);
                    for (let j = 0; j < glitchLength && i + j < data.length; j += 4) {
                        data[i + j] = data[i];
                        data[i + j + 1] = data[i + 1];
                        data[i + j + 2] = data[i + 2];
                    }
                }
            }
        }

        function scanlines(data, targetCanvas) {
            const w = targetCanvas.width;
            for (let i = 0; i < data.length; i += 4) {
                const pixel = i / 4;
                const y = Math.floor(pixel / w);
                if (y % 3 === 0) {
                    data[i] *= 0.5;
                    data[i + 1] *= 0.5;
                    data[i + 2] *= 0.5;
                }
            }
        }

        function colorbleed(data) {
            const output = new Uint8ClampedArray(data);
            for (let i = 4; i < data.length - 4; i += 4) {
                output[i] = (data[i - 4] + data[i] + data[i + 4]) / 3;
                output[i + 1] = (data[i - 3] + data[i + 1] + data[i + 5]) / 3;
                output[i + 2] = (data[i - 2] + data[i + 2] + data[i + 6]) / 3;
            }
            for (let i = 0; i < data.length; i++) data[i] = output[i];
        }

        function nuke(data) {
            for (let i = 0; i < data.length; i += 4) {
                const intensity = (data[i] + data[i + 1] + data[i + 2]) / 3;
                const boost = Math.pow(intensity / 255, 0.3) * 255;
                data[i] = Math.min(255, boost * 1.5);
                data[i + 1] = Math.min(255, boost * 1.3);
                data[i + 2] = Math.min(255, boost * 0.8);
            }
            contrast(data, 100);
            brightness(data, 80);
        }

        function drunk(data) {
            for (let i = 0; i < data.length; i += 4) {
                const wave = Math.sin(i * 0.002) * 50 + Math.cos(i * 0.003) * 30;
                data[i] = Math.min(255, Math.max(0, data[i] + wave));
                data[i + 1] = Math.min(255, Math.max(0, data[i + 1] + wave * 0.8));
                data[i + 2] = Math.min(255, Math.max(0, data[i + 2] + wave * 1.2));
            }
        }

        function rave(data) {
            for (let i = 0; i < data.length; i += 4) {
                const multi = Math.sin(i * 0.001) * 2 + Math.cos(i * 0.002) * 2;
                data[i] = Math.min(255, Math.abs(data[i] * multi));
                data[i + 1] = Math.min(255, Math.abs(data[i + 1] * multi * 1.3));
                data[i + 2] = Math.min(255, Math.abs(data[i + 2] * multi * 1.5));
            }
            contrast(data, 90);
        }

        function dimensionx(data) {
            for (let i = 0; i < data.length; i += 4) {
                const twist = Math.sin(i * 0.0008) * 200;
                data[i] = Math.min(255, Math.abs((data[i] + twist) % 256));
                data[i + 1] = Math.min(255, Math.abs((data[i + 1] - twist * 0.7) % 256));
                data[i + 2] = Math.min(255, Math.abs((data[i + 2] + twist * 1.3) % 256));
            }
        }

        // Initialiser
        createFilterPreviews();
    </script>
</body>
</html>
